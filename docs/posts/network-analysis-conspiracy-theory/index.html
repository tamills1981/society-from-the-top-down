<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-01-28">

<title>Network Analysis and the Paranoid Style – Society From the Top Down</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ffa9a6279353761231ec249df0a7fdd3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Society From the Top Down</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tamills1981"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/tommills.bsky.social"> <i class="bi bi-bluesky" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/ta_mills"> <i class="bi bi-twitter-x" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Network Analysis and the Paranoid Style</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">politics</div>
                <div class="quarto-category">network analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 28, 2026</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><img src="charlie-conspiracy-meme.jpg" class="img-fluid"></p>
<p>It’s all connected man! Conspiracy theory can give network analysis a bad name. But that’s not because network analysis is inherently flawed as a method. As I noted in a <a href="https://tamills1981.github.io/society-from-the-top-down/posts/labour-together-donor-network/">previous post</a>, a network is a model of what is happening in the real world, and you get back what you put in.</p>
<p>Thing is, everything <em>is</em> connected. You don’t need to go Full Latour to recognise that human beings – or anything in the world – exist in a complex set of relationships and dependencies, and cannot be understood outside of them. No one is an island. Relations between people and (other) things give rise to a structure that has its own generative properties. The structure, system, network, or assemblage (whatever you want to call it) is more the sum of its parts. Network analysis is a formal method to try capture this.</p>
<p>But you can’t just impulsively map connections and hope to reveal anything meaningful, except perhaps a reflection of your own assumptions. Perhaps the most well-known and – to a point at least – entertaining example of this in recent years is QAnon, which took off during the first Trump administration. Those guys convinced themselves that Donald Trump was going to save America from a secret network of paedophiles and deep state operatives, and busily tried to expose these hidden networks, <em>doing their own research</em>. Not sure how they are currently processing the Epstein disclosures, but think we can agree that their worldview is a tad misconceived.</p>
<p>But let’s consider a rather more obscure example. Some frenetic network analysis that will only be familiar to you if – speaking of networks – you’ve been knocking around my particular corner of social media for a while. Enter stage left, Mr Paul Mason.</p>
<p>He’s a funny fish, Paul. He has a background on the British Trotskyist Left (Workers’ Power to be exact) and built up a considerable national profile at BBC Newsnight in the 2010s for his reporting of the anti-austerity movements, especially the protests in Greece when the country was being strangled by the bankers, politicians and technocrats of Europe. Mason’s background on the left meant he stood out among the centrist conformists at the BBC, and was able to recognise much more quickly the significance of the political mobilisations that followed the global financial crisis.</p>
<p>When Jeremy Corbyn was elected Labour leader in 2015, it was as a representative of the sorts of movements Mason had been reporting on; movements that opposed imperialism, austerity and neoliberalism. Mason became in those early years a high-profile supporter of Labour’s left turn in a profession that was almost universally hostile, to the point that it dispensed with even the most basic professional standards.</p>
<p>As with some other high-profile centre-left figures, things later soured. Part of the reason for this is no doubt personal. As the shenanigans around Your Party have shown, some of the people around Corbyn are not the easiest to work with. But in Mason’s case there were also political differences. Whereas much of the British left assumes a broadly anti-imperialist position, when it comes to defence and security (which really means war and espionage), Mason has always been closer to the Labour Right (though to be fair he did in 2017 very publicly lambast the Blairites in their lion’s den for their enthusiasm for illegal wars).</p>
<p>Anyway, after 2019 Mason jumped on the Starmer bandwagon, no doubt seeing what he wanted to see: a basically social democratic project that would combine a left economic agenda with an enthusiasm for NATO and MI5. He was half right.</p>
<p>His love was not requited and in keeping with tradition, Mason, who was now relatively marginalised, launched into denunciations of his interlockers on the left, and his analysis, which was always rather idiosyncratic though often thought provoking for that reason, became more and more unhinged. As has often been the case with acrimonious splits on the left, how to respond politically to an armed conflict seemed to have played a significant rule, in this case the full-scale Russian invasion of Ukraine.</p>
<p>In 2022, the US website, the Grayzone, published an <a href="https://thegrayzone.com/2022/06/07/paul-masons-covert-intelligence-grayzone/">article</a> based on hacked emails. One email purportedly from Mason had attached what was described as a ‘dynamic map of the “left” pro-Putin infosphere’, which is pictured below.</p>
<p><img src="grayzone_network.jpeg" class="img-fluid"></p>
<p>I was reminded of this recently when Mason was mocked on social media by two high profile leftwingers in the UK: the Guardian columnist Owen Jones and the Green Party leader Jack Polanski, who both confronted him with the graphic. Mason responded by lamenting that: ‘Outright Putinists are now joining the Greens thanks to Zack’s conversion to the Grayzone agenda’.</p>
<p>In 2022, Mason responded to the original Grayzone exposé with a <a href="https://paulmasonnews.medium.com/response-to-grayzone-article-82d1a1ff6ce6">statement</a> confirming that ‘an attempt was made to hack my encrypted and secure email account’, adding: ‘I make no comment on such materials, which may be altered or faked. Grayzone’s publication has the effect of assisting a Russian state-backed hack-and-leak disinformation campaign.’</p>
<p>As far as I can tell he has never publicly confirmed nor denied producing the diagram. However, the Grayzone recently published an <a href="https://thegrayzone.com/2026/01/27/paul-mason-plotted-grayzone-lawsuit/">article</a> based on new hacked emails, which suggests that Mason did produce it, but didn’t share with any of his spooky acquittances. The article includes the text of an email it says is from Mason to his lawyers in which the ‘network graphic’ is described as an ‘aide memoire for myself’ which ‘attempt[s] to show… people who are clear and overt promoters of Chinese propaganda, and veterans in the pro-Putin hard Stalinist left… on the left of the graph…’ If that sounds reasuring, I should probably point out that the same email mentions ‘a $65m dark money network’ linking Stop the War speakers ‘to Uighur genocide denial’.</p>
<p>Okay, let’s for the sake of this post put the question of authorship aside and focus on the rigour of the ‘network graphic’, whoever was responsible for producing it and for whatever reason.</p>
<p>I don’t want to go all ‘academic marking an essay’ here. But I’m afraid I’m going to have to. Jeremy Corbyn, Zarah Sultana and Novara Media clearly belong in broadly the same political universe, and there’s no reason why you shouldn’t use a network diagram to try and represent that world. It’s a very effective way of modelling and communicating a basic set of relations. With a rigorously produced network/graph you would be able to, for example, identify distinct subcommunities, key figures operating as go-between between those communities and highly connected figures within them. It would be kind of interesting (well to me anyway).</p>
<p>Were you to attempt something like that you could ask people on the British left to identify other people they’ve worked closely with, for example, and use that as a network edge. They’d immediately assume you were an undercover cop or an MI5 asset. But in theory it would work.</p>
<p>You could alternatively use open data to construct a network of organisations where individuals have held formal positions of authority, and then produce a person-to-person ‘projection’ of that bipartite graph, where pairs of individuals are connected if they both held contemporaneous positions at the same organisation. Then, if this is your thing, you could identify those taking more critical stances on NATO, or those who are more sympathetic to the Chinese Communist Party.</p>
<p>This diagram is not that. Though to be fair it does make a bit more sense than some people have given it credit for. There are some categories represented. First, individuals and organisations are in lower and uppercase respectively, and the ‘nodes’ on the right of the diagram are coloured differently to the others. The idea seems to be to illustrate influence from Russia and China on the left of the diagram/network to the social groups coloured differently to the right, hence the direction of the edges. So, for example, China influences the China-based British economist John Ross, who is a leading figure in Socialist Action. Socialist Action influences Zarah Sultana, who in turn influences Britain’s ‘Muslim Community’ and the ‘Young Networked Left’.</p>
<p>A network that it amenable to quantitative analysis requires some degree of homogeneity in its nodes and edges. This seems to be closer to a qualitative social network that diagrammatically represents a heterogenous set of relations between people and things. This is in principle fine. But what is crucial is specifying the nature of the connections. Otherwise, how can the reader interpret the diagram, let alone assess the strength of the underlying evidence? What specifically is the nature of the chains of influence being claimed here and how strong are they? There’s nothing.</p>
<p>Then there is the selection criteria for the data. Does this reflect the full range of political influences on each person, organisation or group? Obviously not. Then there’s the direction of the influences. The Trade Unions are apparently influenced by Richard Burgeon and Marcus Barnett, but themselves exert no influence over any other people or organisations. Why are the individual trade unions not distinct organisations with relations, rather than passive recipients of recycled Russian and Chinese propaganda?</p>
<p>Diane Abbott apparently has no influence at all (assuming that’s what the lines represent) over anyone, including Britain’s Black Community (and neither is she influenced by it). Novara Media apparently does.</p>
<p>In the end, what we are left with is a paranoid depiction of the influence of Russia and China on various social groups, via some quite marginal political figures, without the nature of that influence ever being specified. It’s little more than a pictural representation of a series of political assertions – the product of exactly the sort of erratic yet dogmatic thinking that characterises conspiracy theory.</p>
<p>To be fair, whoever produced that paranoid mind map didn’t intend it to be published. But believe it or not, it wasn’t even the worst example of conspiratorial network analysis that attempted to ‘map’ the Corbyn movement in that period, and this next one was published by a national media organisation.</p>
<p>On 7 December 2019, days before the General Election that year, <em>The Sun</em> published an <a href="https://web.archive.org/web/20191207145207/https://www.thesun.co.uk/news/10501848/jeremy-corbyn-extremist-network/#">article</a> under the headline, ‘Ex-British intelligence officers say Jeremy Corbyn is at the centre of a hard-left extremist network’ (thanks to Twitter’s <a href="https://x.com/Mr_Considerate">Mr Considerate</a> for helping me dig this one up, which I had only half remembered). That network, pictured below, was described as an ‘extraordinary network of hard-left extremists pieced together by former British intelligence officers’.</p>
<p><img src="Hijacked Labour.jpg" class="img-fluid" width="900"></p>
<p>It is extraordinary. Apparently a team of volunteers produced it in their spare time, led by a Sandhurst and Oxford educated former SAS officer. If you liked the last network you’ll love this one. It contains 430 nodes, among them: Post Modern Neo-Marxism, Gerry Adams, NBC, and Corbyn’s Communist Campaign Unit. At the centre is Corbyn himself, surrounded by a ‘spider’s web of extensive contacts’.</p>
<p>Where this is different to the previous network is the different parts are coloured to indicate different communities, with the orange community at its heart including Corbyn, his advisor Seumas Milne, and <em>checks notes</em> Global Marxism. This was almost certainly produced using the free network visualisation software Gephi, which I used for a <a href="https://tamills1981.github.io/society-from-the-top-down/posts/labour-together-donor-network/">previous post</a>.</p>
<p>I don’t want to put you off network analysis. Have a go with Gephi. It’s a great tool. But for the love of God please think about what you are using to construct your network.</p>
<p>I won’t repeat my previous points about the homogeneity of ‘things’ represented as nodes or the connections between them (‘edges’). Hopefully it is obvious to any reader why ‘Post Modern Neo-Marxism’ is not the same sort of ‘thing’ as Seumas Milne and shouldn’t be treated as such in a network diagram, let alone an actual graph that is going to be analysed statistically (as was the case here since community detection was used).</p>
<p>One point I would make though is that these sorts of abstractions (paranoid or otherwise) can be put to use, but not in this way, and needless to say with a degree of analytical sobriety that is here completely absent.</p>
<p>One weakness of network analysis is its empiricism. It’s very good at representing easily classifiable connections between things that give rise to a structure of relations. But there’s a lot of complexity – especially when it comes to humans – that it cannot readily capture. If you want to assert there’s something called ‘Post Modern Neo-Marxism’ then go for it. Knock yourself out. But this isn’t a ‘thing’ that belongs in a network. The great leftwing Weberian historical sociologist Michael Mann once responded to a study representing the state as a network of policy actors like this:</p>
<blockquote class="blockquote">
<p><em>Do we have to abandon substantive theory and construct our theory merely from the formal properties of maps of the dense organizational networks of modern political influence, as Laumann and Knoke (1987) do? Despite the considerable virtues of their organizational theory, and the parallels between their enterprise and my own, does it not sometimes miss the wood for the trees? The American state surely is at some ‘higher’, macro level capitalist; it is also essentially federal and it possesses the most powerful militarism in the world. I would not have guessed this from their maps of complex organizational power networks.</em></p>
</blockquote>
<p>A macro level entity or concept like capitalism (or ‘Post Modern Neo-Marxism’!) doesn’t belong in a network, but it doesn’t have to be dispensed with because you are using network analysis as a method. Such abstractions are of course potentially useful and can be used to intepret a network, its structure, dynamics and communities. We all try to make sense of complexity, and that’s what theory (explicit or not) does for us.</p>
<p>In my view the lay impulse to try and make sense of the world by investigating connections between people, groups, institutions and ideas perfectly healthy, and the particular preoccupation with hidden connections amongst powerful people is a response to the unequal and basically undemocratic nature of our societies, as well as the inadequacy of our dominant systems of thought.</p>
<p>But lay theorising can of course result in completely outlandish ideas. For realists the key point to hold on to is that not all theories, or methods, are equal. When it comes to networks, you can’t just erratically map a myriad of different types of connections and expect to thereby reveal a hidden generative structure, let alone identify who or what caused some event.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/tamills1981\.github\.io\/society-from-the-top-down\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>