<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-01-21">

<title>Capital and Conservatism – Society From the Top Down</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ffa9a6279353761231ec249df0a7fdd3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Society From the Top Down</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tamills1981"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/tommills.bsky.social"> <i class="bi bi-bluesky" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/ta_mills"> <i class="bi bi-twitter-x" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Capital and Conservatism</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">elites</div>
                <div class="quarto-category">capital</div>
                <div class="quarto-category">conservatism</div>
                <div class="quarto-category">media</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 21, 2026</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>I was trying to dig something up from my <a href="https://x.com/ta_mills">Twitter feed</a> the other day and came across this talk I did back in 2021 for a panel at <a href="https://theworldtransformed.org">The World Transformed</a> called ‘How Do We Understand the Right?’. At the time, one thing I was giving a lot of thought was how we should understand the relationship between conservativism and capital/capitalists.</p>
<p>This is part of a broader question around the relationship between capital (or big business) and politics and the state, which was a major preoccupation in Western Marxism in the 1970s (relative autonomy and all that), but which quickly descending into fairly abstract theoretical debate around state theory and then fizzled out in the 1980s. Meanwhile, a parallel tradition in social science - also with intellectual roots in the work of C. Wright Mills - examined the political power of big business, and within scholarship on corporate networks in particular there has been a micro-debate, prompted by Mark Mizrachi, around whether business elites in the US have become ‘fractured’, with the implication that this lack of leadership and intra-class cohesion has led to a long period of extreme inequality and political crisis.</p>
<p>A similar sort of argument has been made by Aeron Davis in the UK where during the 2010s and early 2020s, the period of austerity and then Brexit posed the question of to what extent we should understand these disrputive and economically harmful events as reflecting the culture of political elites, or the interests of business. Then of course there was Jeremy Corbyn’s leadership of the Labour Party, and the hysterical response from the whole political-media establishment, which posed similar questions in strategic terms for the left, including on the role of the news media.</p>
<p>My view on all this is firstly that these questions can’t be answered through abstract theorising, and secondly that the instinctive suspicion of any recognition of elite or ruling class agency that both social science and the left share is as much a block to a rigorious analysis as conspiratorial thinking that overemphasies such agency and power. I’d previously written a piece for <em>Jacobin</em> called <a href="https://jacobin.com/2018/10/ruling-class-elites-conspiracies-antisemitism-marxism/">‘Can the Ruling Class Speak?’</a> that touches on some of this and argues for recognising such agency.</p>
<p>Anyway, in this talk I tried to sketch out how I think the left should understand conservatism in capitalist societies. Below is an edited transcript of my contribution, or you can watch the whole video below. I’m on at around 30mins in.</p>
<p>This is something I’m hoping I’ll be able to return to this year.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/_xATfFJArAo" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<section id="edited-transcript" class="level3">
<h3 class="anchored" data-anchor-id="edited-transcript">Edited Transcript</h3>
<p>Thank you. It’s great to be here and in such good company. And it’s really nice… I mean if anyone knows me, I’m normally at these kinds of events as the left’s BBC guy. So it’s nice to be let out my BBC box and broaden a little bit, so thanks for having me.</p>
<p>I am going to talk about the media a little bit, but really what I wanted to try and do was think about how we on the left should analyse the media and analyse the relationship between the media, political practice, capital and conservatism – to think about the relationship between these things.</p>
<p>I’m really glad we’re having this panel because I think there’s a tendency for us on the left to get all dreary and upset and self-flagellating about all the problems, which God knows that we have, with ourselves, and to sometimes lose track of thinking about the enemy. And there is a political enemy. These people are human beings like us and they operate in institutions and they have objectives, which they try and fulfil and they operate strategically.</p>
<p>We need to do the same and if we’re going to do that effectively we need to think about who these people are, what they want, and how they get it, and that’s why I think this panel is really important now.</p>
<p>I think it’s useful first of all for us on the left to start with the recognition that capital and conservativism are distinct. Now in practice they overlap considerably and I think particularly in in this country that’s why we don’t tend to think about them as such, but it’s important that we see them as being distinct analytically, and overlapping in practice as an actually existing set of institutions and movements.</p>
<p>So capitalists can be conservatives and they often are conservative supporters – not all of them but the vast majority of them – and conservatives can be capitalists. They, conservatives, tend not to be capitalists, or at least conservative supporters tend not to be capitalists. That’s what we’ve been discussing so far; that effort to reach out beyond that narrow class interest.</p>
<p>Now we have to remember that so as not to fall into two traps. Number one is not to think of everything as being the result of a ruling class or elite capitalist interests, and the second one, which I think is the trap which probably people at TWT aren’t going to fall into so much, is thinking about the enemy as being purely a set of bigoted conservative ideas or institutions – so say like the Daily Mail for example. This is kind of a liberal fallacy and if you’re there then hopefully we’ll get you out of that point by the time we finish this panel and have a discussion.</p>
<p>We have to understand these social groups as being distinct from each other, but having overlapping interests, and then that plays out through the political system and in society. So, capitalists in the narrow sense that Marx uses the term, like any elite, like any ruling class, as Owen said at the beginning, they are a minority interest in society. This is the sort of kernel of Marxist analysis. They have to build beyond that and they can do that in different ways.</p>
<p>The many contradictions of conservatism are basically rooted in that effort to build popular support for a minority interest. It’s a structural feature of capitalism that they have to do this. They can try and do it through liberalism with an appeal to universalist ideas, and that leads to all kinds of contradictions about what freedom means. But usually the best the way they can do this is through an appeal to social hierarchies, as Richard laid out at the beginning.</p>
<p>Now this this panel isn’t about liberalism, but I think it’s important to mention that the relationship between capitalism or capital and conservatism is contingent. It could go in different directions. You can appeal to liberalism and you have liberal capitalists. But that need to represent a minority interest of a class as being universal is fundamental to capitalism and that is what conservatism is rooted in ideologically, that’s the structural feature of it.</p>
<p>So what are the interests of capital? Well the accumulation of more capital. We can go and read Capital and we can all swat up on that. In basic terms, making profit and expanding their market share. So capitalist interests, the capitalist ruling class, you know they do have a sort of structured rationality to them because they operate in market structures and in that sense we can think of capitalists as being a more rational ruling class. They calculate, they have balance books, they read the FT, they keep their eye on the markets, they look at their investment. They have these structured sets of interests. But we can’t simply appeal to capitalist interest and expect them to do X, Y or Z. These are real human beings as Richard said earlier. They are embodied in in a very specific social context. They’re not all seeing, they’re not all knowing. They don’t necessarily know what their interests are, and they’re also not as homogeneous as abstract class theory can sometimes make them seem. They’re different from each other. Now Marx called capitalists a band of warring brothers or some sort of words to that effect. Richard will probably know the actual quote. Maybe some of the other panellists may. But they have conflicting interests structured by nation and industrial sector and so on. They’re also very unequal in terms of their wealth and power. More than workers actually. So if you look at wealth differences, the closer you get to the top of that 1%, that 0.1%, and up and up and up you go, all the capitalists are incredibly unequal until you get up to those billionaires. So they’re a very fractured class and they need to develop a collective sense of their own project.</p>
<p>We can think of capitalists as having a core and a periphery if you like. At the core you’ve got the financiers and the billionaires. Then you’ve got parochial business interests and everything in between. Then beyond that minority class interest you’ve got other classes I’ll talk about in a minute. But the point is they have to negotiate and articulate a set of interests through an actual existing set of institutions and they need to mobilize their interests in politics and civil society.</p>
<p>They do that through a number of institutions. They do that through the Conservative Party, which is a subject of a recent book by Phil Burton-Cartilage I recommend you read, published by Verso. They do that in less public organisations. They do that in business and industrial associations, they do it through media organisations, which is my area, they do it through public affairs consultancies so lobbyists – that’s just basically a euphemism for lobbyists – through think tanks and so on. This is the infrastructure of the conservative movement and that overlaps with capitalism in this country.</p>
<p>The point is that their interests aren’t self-evident. They are not unchanging. They have organisations and groups to do this, like we do, they have their own TWTs, but they don’t look like this obviously and they don’t look like us – at least I hope they don’t, I hope we don’t.</p>
<p>Now beyond those core capitalist interest they have to build broader coalitions and this is what Gramsci referred to as historic bloc. So beyond the capitalists themselves you’ve got – sticking with Marxist categories – you’ve got the petty bourgeoisie, the little capitalists right, the owners of small businesses. Then you’ve got the middle-class people. Workers supposedly part of our class. Now these are the people in the upper parts of the class structure who share very close interests with capital: corporate lawyers, accountants, senior corporate managers, advertisers – some of my best friends I’ve nothing personally against these people – public relations consultants, wealth managers. This is the natural, consistent, constituency.</p>
<p>And then beyond that you’ve got to reach out to build broader political support, working-class support, the lower middle classes. That’s where conservative ideology fits in. Now I’m not going to linger too much on conservative ideology because the other speakers have done a good job so far and I’m not even the last speaker. But I did want to share this very popular quote from Aneurin Bevan: ‘How can wealth persuade poverty to use its political freedom to keep wealth in power? Herein lies the whole art of conservative politics in the 20th century.’</p>
<p>Now of course it’s not just about wealth right it’s also about a whole set of racialized and gendered conceptions of social authority that allows them to build up this broader support and that’s been mentioned before. This is ultimately what conservatism is about.</p>
<p>Now I think one important point I’d like to make if there’s a takeaway from my talk is that what we should never do on the left is attack the right based on the inconsistency and incoherence of their ideas. Yes capitalist interests are sort of rational. But the political practice of defending the rule of capital and defending power more broadly; that is not a project that needs coherence. It’s a reactive project. It’s more about neutralizing threats and making politically convenient arguments in political struggle than it is about building consent in any coherent or meaningful way. This is why they seem so wild all the time and why they don’t care about lying. There’s a structural reason that conservatism is so dishonest. It’s politically dishonest because it’s trying to build beyond the narrow constituency and sell that as being in the broader interest.</p>
<p>I’m not just saying that they lie all the time, which they do. Let’s think back to the 2019 election where there was that study looking at political advertising that found, I don’t know what it was it was like 83% or something like that of conservative political advertising was misleading. Labour was much, much lower. They have to lie in order to build this coalition. They don’t need to be coherent. So people need to stop attacking them for being contradictory or hypocritical or any of these things. They don’t care about that stuff. What they care about is winning, and that’s what we should care about. But we should not abandon ourselves our commitment to truth in doing so. Let’s leave that to them.</p>
<p>Now I need to get on to the media, because I’m the media guy. What role does the media play in this process of reaching beyond this narrow class interest and broadening it? Now I think it’s useful for us to think about the media in broader terms than just as one system. Different media organisations do different things. The right has their elite media, so that’s the Spectator and the Telegraph and to some extent The Times. The current ruling clique of the Conservative Party is very networked into the Spectator and the Telegraph. Then there’s the liberal stuff. I’m not going to talk about liberals, but remember we’ve got The Economist we’ve got the FT, and The Times is kind of in the middle. Then there’s the popular press which has been a real strength of the right in this country. The Sun and the Daily Mail perform such an important function for the right. There’s all these debates about how powerful they are, how much do they persuade people. Well the jury was out for a while, but there was some research published by Aaron Reeves and colleagues a few years ago, I think it was 2006 maybe, which looked at Sun readers and what they found was that the switch of the Sun’s loyalty in the case of the 2010 election and the 1997 election was able to deliver seven points and fifteen percentage points respectively, controlling for values. So no change in political attitudes. This is very small parts of the population, but they do they do have that concrete role. They can swing elections.</p>
<p>But that’s a very small electoral impact. That’s a very narrow measure. What the reactionary media does is they play a constant role in misrepresenting issues and particularly in smearing the left. They don’t necessarily have to convince anybody that left-wing ideas are bad. They just need to convince people that the people who are pushing them are bad and we saw that all the time. We’re all going to be very familiar with that.</p>
<p>These institutions, the Murdoch media and the Daily Mail, the reason they play this very important function isn’t by the way just for swinging elections, that’s a very narrow thing. They play a much broader role in the practice of conservatives. And why do they do that? They are organisations of the ruling class in the narrow sense they’re owned by oligarchs. These are billionaire tax avoiders. But also by the nature of their market position. They have to appeal to a broad audience, that’s what these businesses do. So they’re used by the Conservative Party as sort of feelers for that process of appealing to popular reaction and building up those constituencies and those attitudes. That’s what conservatism feeds off, so it’s a very important function that they perform in what we might call the capital-conservative power structure. They help to keep the Tories ‘in touch’ to use that horrible cliche that’s always used on the BBC and so on.</p>
<p>Alright I’m going to wrap up right because I feel like I’ve talked for quite a long time. What can we conclude from this? I think we need to be a little bit careful in terms of not thinking about a battle of ideas. The right doesn’t think in these terms. They think about interests and they think about the ideas that bind together and serve those interests in particular context.</p>
<p>So I think the left needs to start thinking about where we’re strongest and that’s probably in areas like you know the appeals that we can make to the public, those sets of ideas. We don’t we don’t have a lot of social power in our institutions at the moment. Perhaps certain trends in political demography will change that. But what we really need to think about is where the enemy are weakest and this means being attentive to their ideas and interests and the way that this capital-conservative coalition is structured in this country. I think we also need to avoid thinking about the UK or other capitalist countries as being inherently and irrevocably conservative. The right has to work to win. They work hard to do that and they have an advantage almost axiomatically by the fact that they are the people in power. So we’re at a disadvantage and that’s why I think research on them and strategic thinking about how the right operate is so important. I think we need more of that and I’m really glad to be part of this panel which I hope is the start of a conversation and a longer process.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/github\.com\/tamills1981\/society-from-the-top-down");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>